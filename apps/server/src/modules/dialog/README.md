# Dialog Module (P0-05)

## Назначение

- Загружает сценарий, указанный в `apps/server/src/constants.ts` (по умолчанию `assets/s2/s2.json`), и валидирует его через Zod.
- Индексирует шаги по `id` и определяет корневой шаг (`prev.length === 0`).
- Проверяет наличие видеофайлов `<videoId>.mp4` в папке сценария (например, `assets/s2`).
- Формирует payload `session_step` на основе сценария и текущего состояния сессии.
- Логирует ошибки парсинга сценария (JSON/Zod) с путями до проблемных полей.
- Для `actor.name = waiter` назначает `video` сразу обеим ролям (MALE/FEMALE), чтобы оба клиента видели одно и то же видео шага.

## Контракты

- Вход: JSON-файл сценария из `ASSETS_DIR` (минимальный срез сценария, остальное игнорируется).
- Выход: `SessionStepEvent` (`session_step` по WS).

## Обоснование

Сценарий и медиа валидируются на старте, чтобы сервер падал сразу при
неконсистентном контенте. Это гарантирует, что клиент получает корректный
первый шаг без скрытой логики.
