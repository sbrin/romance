# State & Storage

## Назначение

Локальный reducer и утилиты хранения deviceId/role в localStorage для core flow.

## Требования

- Reducer описывает переходы только по событиям сервера/пользователя.
- deviceId и role валидируются через Zod-схемы.
- localStorage используется идемпотентно и устойчиво к ошибкам.
- Роль хранится локально после первого выбора и не сбрасывается при отмене поиска.
- Дефолтное состояние при сохраненной роли — экран «начать поиск».
- Сохраненная активная сессия (sessionId + последний шаг) валидируется через Zod
  и используется для восстановления диалога после перезагрузки.

## Обоснование

Сервер — источник правды, поэтому клиент хранит только минимальный UI state и
стабильные идентификаторы устройства.
