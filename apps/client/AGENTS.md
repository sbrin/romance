# Development Guide: Romance‑Chat Frontend

Этот документ определяет технологический стек, архитектурные принципы и
методологию разработки клиентской части Romance‑Chat.

---

## 1. Технологический стек

- **Runtime:** браузер (мобильный, портретный режим)
- **Language:** TypeScript (Strict mode)
- **Framework:** React + Vite
- **Validation:** Zod (через `@romance/shared`)
- **Real‑time:** Socket.io client
- **State:** простой локальный state + reducer (без тяжёлых библиотек)
- **Styling:** CSS (App.css / index.css), CSS variables

---

## 2. Архитектурные принципы

### A. Vertical Slicing (Feature‑First)

Мы не разделяем код по техническим слоям. Каждая бизнес‑фича живёт в своей папке
и содержит всё необходимое (экран, логику, типы, минимальные стили).

Рекомендуемая структура:

```
apps/client/src/features/
  role/
  queue/
  search/
  session/
  content/
apps/client/src/ui/
apps/client/src/api/
apps/client/src/state/
```

### B. Server as Source of Truth

Клиент — «глупый терминал». Вся логика переходов и сессий на сервере. Клиентский
UI отражает серверные события и состояния.

- `SessionState` = источник правды
- Клиент не "предсказывает" переходы
- Любая критичная логика — на сервере

### C. Fail Fast & Guardrails

1. **Zod Everywhere:** любые входные/сетевые данные валидируются Zod‑схемой из
   `@romance/shared`.
2. **Type Safety:** `any` запрещён.
3. **Idempotent UI:** повторный вызов `POST /queue/join` не ломает логику.

---

## 3. UX / UI принципы (V1)

- Мобильный портретный экран — основной целевой формат.
- Вся UI‑иерархия в одном потоке: выбор пола → очередь → мэтч → старт → диалог.
- Чёткие состояния UI:
  - выбор пола
  - ожидание
  - партнёр найден
  - партнёр отменил чат
  - ожидание старта
  - мой ход
  - жду ответ
  - предупреждение тайм‑аута
  - завершено
- Видео — fullscreen, без звука, всегда в фоне.
- Текст реплики — поверх видео (bubble), максимум читабельности.

---

## 4. Сетевые контракты

Использовать строго контракт `packages/shared/contracts-core-flow.md`.

Ключевые правила:

- `deviceId` создаётся 1 раз и хранится в localStorage.
- Socket.io auth всегда `{ deviceId }`.
- `POST /role` сохраняет роль.
- `POST /queue/join` ставит в очередь или возвращает `PARTNER_FOUND`.

---

## 5. Контент без кода

Контент редактируется сценаристами без участия разработчика:

- Сценарий: `apps/client/public/content/scenario.json`
- Видео: `assets/s2/*` (сервер отдает по `/videos/`)

Клиент всегда загружает сценарий динамически (`fetch` + Zod‑валидация).

---

## 7. Принципы разработки UI

- Максимально простой и фокусный интерфейс.
- Любой экран должен быть читаемым за 3 секунды.
- Кнопки должны быть крупными и пригодными для touch.
- Анимации — минимальные, но выразительные (не "шум").

---

## 8. События и аналитика (минимум)

Клиент должен логировать ключевые события (console или отдельный канал):

- `selected_gender`
- `queued`
- `partner_found`
- `start_pressed`
- `session_started`
- `choice_made`
- `timeout_warn`
- `timeout_end`
- `disconnect`
- `session_end`

---

## 9. Запрещено (V1)

- Любая "умная" логика на клиенте вместо сервера
- Свободный ввод текста/голоса
- Хранение контента в коде
- Любые зависимости, которые усложняют билд без необходимости
