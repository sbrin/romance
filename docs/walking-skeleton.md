# Walking skeleton (one thread)

## E2E сценарий

Пользователь А открывает сайт → выбирает роль → попадает в очередь →
пользователь Б делает то же → сервер матчится → оба видят «Партнёр найден» → оба
нажимают Start → показывается 1 шаг диалога с вариантами → оба выбирают → шаг
фиксируется → сессия завершается → оба видят «Сессия завершена» и кнопку «В
очередь».

## Минимальный срез по слоям

### UI

- Экран выбора роли (2 кнопки).
- Экран «Вы в очереди» + индикатор ожидания.
- Экран «Партнёр найден» + кнопка Start + статус «жду второго».
- Экран шага: Фулл-скрин видео (Loop) + одна реплика (бабл) + 2–3 кнопки
  ответа + состояния «мой ход / жду».
- Экран «Сессия завершена» + кнопка «В очередь».

### Доменная логика

- Роли: male/female.
- Очередь и матчинг по противоположному полу.
- Сессия: состояние `waiting_for_start` → `active` → `finished` / `timed_out` /
  `aborted`.
- Тайм-аут: серверный таймер для обработки зависаний и дисконнектов.
- Один шаг диалога с выбором ответа (внутри `active` храним `current_step_id`,
  `turn_user_id`).
- Синхронный переход на следующий (в skeleton можно завершать сразу после выбора
  обоими).
- Резолвинг контента: выбор пользователя определяет следующее видео для партнёра
  (логика из файла сценария).

### Хранение / интеграции

- Персистентность сессии и её состояния (минимум: id, роли, статус, выбранные
  ответы).
- Очередь ожидания (можно в памяти/Redis).
- Реал-тайм канал для состояния (WebSocket/SSE).
- Источник сценария: статический JSON/YAML файл + папка с видео (без БД для
  контента).

### Деплой

- Один backend сервис + статический фронт.
- Простая конфигурация среды (dev/prod).
- E2E прогон через публичный URL.

## Минимальные API/события

- `POST /role` → сохранить роль.
- `POST /queue/join` → встать в очередь.
- `GET /session` → получить состояние/матч.
- `POST /session/start` → подтвердить старт.
- `POST /session/step/answer` → ответ на шаг.
- Реал-тайм: `session.updated` (статус, чей ход, шаг, `video_url`,
  `bubble_text`).

## Критерии готовности (E2E)

- Два клиента проходят сценарий целиком без ручных фиксов.
- Оба видят корректный шаг; видео партнера обновляется сразу после выбора.
- После завершения можно снова встать в очередь.
